{% extends 'base.html' %}

{% block content %}
  <div class="row mb-4">
    <div class="col-md-8">
        <h1><i class="fas fa-house"></i> {{ case['via'] }}, {{ case['civico'] }}</h1>
        {% if case.get('photo') %}
          <img src="{{ url_for('uploaded_file', filename=case.get('photo')) }}" alt="Foto casa" class="img-fluid my-3" style="max-height:300px;">
        {% endif %}
        <p>
          {% if case.get('tipo_annuncio') == 'vendita' and case.get('price_sale') %}
            <strong class="text-success">Prezzo vendita: €{{ '%.2f'|format(case.get('price_sale')) }}</strong>
          {% elif case.get('tipo_annuncio') == 'affitto' and case.get('price_rent') %}
            <strong class="text-info">Affitto: €{{ '%.2f'|format(case.get('price_rent')) }} /mese</strong>
          {% elif case.get('tipo_annuncio') == 'affitto/vendita' %}
            {% if case.get('price_rent') %}<strong class="text-info">Affitto: €{{ '%.2f'|format(case.get('price_rent')) }} /mese</strong><br>{% endif %}
            {% if case.get('price_sale') %}<strong class="text-success">Vendita: €{{ '%.2f'|format(case.get('price_sale')) }}</strong>{% endif %}
          {% endif %}
        </p>
      
    </div>
    
    {% if g.user and g.user['id'] == case['author_id'] %}
      <div class="col-md-4 text-end">
        <a href="{{ url_for('main.add_coinquilino', immobile_id=case['id']) }}" class="btn btn-primary btn-lg">
          <i class="fas fa-user-plus"></i> Aggiungi Coinquilino
        </a>
      </div>
    {% endif %}
  </div>

  <h3 class="mt-4 mb-3">
    <i class="fas fa-people-group"></i> Coinquilini
  </h3>

  {% if not coinquilini %}
    <div class="alert alert-info text-center" role="alert">
      <i class="fas fa-info-circle"></i>
      <strong>Nessun coinquilino registrato.</strong>
      {% if g.user and g.user['id'] == case['author_id'] %}
        <a href="{{ url_for('main.add_coinquilino', immobile_id=case['id']) }}" class="alert-link">Aggiungi uno!</a>
      {% endif %}
    </div>
  {% else %}
    <div class="row">
      {% for coinquilino in coinquilini %}
        <div class="col-md-6 mb-4">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">
                <i class="fas fa-user text-primary"></i> {{ coinquilino['nome'] }} {{ coinquilino['cognome'] }}
              </h5>
              
              <p class="card-text text-muted">
                <small>
                  <i class="fas fa-envelope"></i> {{ coinquilino['email'] }}
                  {% if coinquilino['eta'] %}
                    <br>
                    <i class="fas fa-birthday-cake"></i> <strong>{{ coinquilino['eta'] }} anni</strong>
                  {% endif %}
                  {% if coinquilino['numero_persone'] %}
                    <br>
                    <i class="fas fa-people-group"></i> <strong>{{ coinquilino['numero_persone'] }} persone</strong>
                  {% endif %}
                  {% if coinquilino.get('importo') is not none %}
                    <br>
                    <i class="fas fa-euro-sign"></i> <strong>{{ '%.2f'|format(coinquilino['importo']) }} €/mese</strong>
                  {% endif %}
                  {% if coinquilino.get('giorno') is not none %}
                    <br>
                    <i class="fas fa-calendar-day"></i> Giorno: <strong>{{ coinquilino['giorno'] }}</strong>
                  {% endif %}
                </small>
              </p>
              
              
              
              {% if g.user and g.user['id'] == case['author_id'] %}
                <div class="d-flex gap-2">
                  <a href="{{ url_for('main.edit_coinquilino', coinquilino_id=coinquilino['id']) }}" class="btn btn-sm btn-warning">
                    <i class="fas fa-edit"></i> Modifica
                  </a>
                  <form method="post" action="{{ url_for('main.delete_coinquilino', coinquilino_id=coinquilino['id']) }}" style="display: inline;">
                    <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Sei sicuro?')">
                      <i class="fas fa-trash"></i> Elimina
                    </button>
                  </form>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <div class="mt-4">
    <a href="{{ url_for('main.index') }}" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i> Torna alla lista
    </a>
  </div>
{% endblock %}
