{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">
  <div class="row">
    <div class="col-md-12">
      <h1 class="mb-4">
        <i class="fas fa-envelope-open-text"></i> Le Tue Offerte
        {% if offerte %}
          <span class="badge bg-primary">{{ offerte|length }}</span>
        {% endif %}
      </h1>

      {% if offerte %}
        <div class="list-group">
          {% for offerta in offerte %}
            <div class="list-group-item list-group-item-action mb-3 p-4" style="border-radius: 10px; border-left: 5px solid #007bff;">
              
              <!-- Intestazione -->
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                  <h5 class="mb-1 d-flex align-items-center">
                    {% if offerta.sender_profile %}
                      <img src="{{ url_for('uploaded_file', filename=offerta.sender_profile) }}" alt="Profilo" class="rounded-circle me-2" width="48" height="48">
                    {% else %}
                      <i class="fas fa-user-circle me-2" style="font-size: 1.5rem;"></i>
                    {% endif %}
                    {{ offerta.get('sender_username', offerta['nome']) }} {{ offerta['cognome'] }}
                  </h5>
                  <small class="text-muted">
                    <i class="fas fa-calendar-alt"></i>
                    {{ offerta['created'][:10] }}
                  </small>
                </div>
                <div>
                  <span class="badge" style="background-color: {% if not offerta.get('read') %}#dc3545{% else %}#28a745{% endif %};">
                    {% if not offerta.get('read') %}Non letto{% else %}Letto{% endif %}
                  </span>
                </div>
              </div>

              <!-- Informazioni Proprietario -->
              <div class="row mb-3">
                <div class="col-md-6">
                  <small class="text-muted">
                    <i class="fas fa-envelope"></i> <strong>Email:</strong><br>
                    <a href="mailto:{{ offerta['email'] }}">{{ offerta['email'] }}</a>
                  </small>
                </div>
                <div class="col-md-6">
                  {% if offerta['numero_telefono'] %}
                    <small class="text-muted">
                      <i class="fas fa-phone"></i> <strong>Telefono:</strong><br>
                      <a href="tel:{{ offerta['numero_telefono'] }}">{{ offerta['numero_telefono'] }}</a>
                    </small>
                  {% endif %}
                </div>
              </div>

              <!-- Casa Interessata -->
              <div class="alert alert-light mb-3">
                <i class="fas fa-home"></i> <strong>Casa:</strong> {{ offerta['via'] }}, {{ offerta['civico'] }}
              </div>

              <!-- Messaggio -->
              <div class="mb-3">
                <strong>Messaggio:</strong>
                <p class="mt-2" style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 3px solid #007bff;">
                  {{ offerta['messaggio'] }}
                </p>
              </div>

              <!-- Azioni -->
              <div class="d-flex gap-2">
                <a href="{{ url_for('main.respond_offerta', offerta_id=offerta['id']) }}" class="btn btn-sm btn-primary">
                  <i class="fas fa-reply"></i> Rispondi
                </a>
                <form method="post" action="{{ url_for('main.delete_offerta', offerta_id=offerta['id']) }}" style="display: inline;">
                  <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Eliminare questa offerta?')">
                    <i class="fas fa-trash"></i> Elimina
                  </button>
                </form>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-info text-center py-5">
          <i class="fas fa-inbox" style="font-size: 3rem;"></i>
          <h4 class="mt-3">Nessuna offerta ricevuta</h4>
          <p class="text-muted">Non hai ancora ricevuto offerte per le tue propriet√†.</p>
        </div>
      {% endif %}

      <div class="mt-4">
        <a href="{{ url_for('main.index') }}" class="btn btn-secondary btn-lg">
          <i class="fas fa-arrow-left"></i> Torna alla Home
        </a>
      </div>
    </div>
  </div>
</div>

<style>
  .list-group-item {
    border: none;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }
  
  .list-group-item:hover {
    transform: translateX(5px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }
  
  .list-group-item-action {
    cursor: pointer;
  }
</style>
{% endblock %}
